<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper  namespace="com.ucar.datalink.biz.dal.LabSwitchDAO">

    <resultMap id="labSwitchResult" type="labSwitch">
        <result property="id" column="id"/>
        <result property="version" column="version"/>
        <result property="businessLine" column="business_line"/>
        <result property="status" column="status"/>
        <result property="switchProgress" column="switch_progress"/>
        <result property="fromCenter" column="from_center"/>
        <result property="targetCenter" column="target_center"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="virtualMsIds" column="virtual_ms_ids"/>
        <result property="originalContent" column="original_content"/>
        <result property="switchStartTime" column="switch_start_time"/>
    </resultMap>

    <!-- all columns -->
    <sql id="allColumns">id,version,business_line,status,switch_progress,from_center,target_center,start_time,end_time,virtual_ms_ids,original_content,switch_start_time</sql>

    <select id="getLabSwitchByVersion" resultMap="labSwitchResult">
        select
        <include refid="allColumns"/>
        from t_dl_lab_switch where version = #{version}
    </select>

    <insert id="insert" parameterType="labSwitch" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_dl_lab_switch
        (version,business_line,status,switch_progress,from_center,target_center,start_time,end_time,virtual_ms_ids,original_content,switch_start_time)
        VALUES
        (#{version}, #{businessLine},#{status},#{switchProgress},#{fromCenter},#{targetCenter}, now(), now(),#{virtualMsIds},#{originalContent},#{switchStartTime})
    </insert>

    <update id="update" parameterType="labSwitch">
        update t_dl_lab_switch
        set
        status=#{status},
        switch_progress=#{switchProgress},
        start_time=#{startTime},
        end_time=#{endTime}
        where id = #{id}
    </update>


    <select id="findAll" resultMap="labSwitchResult">
        select
        <include refid="allColumns"/>
        from t_dl_lab_switch order by start_time desc
    </select>

</mapper>